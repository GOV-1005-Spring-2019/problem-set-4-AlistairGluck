---
title: "problem-set-4-AlistairGluck"
author: "Alistair Gluck"
date: "2/25/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(broom)
library(gt)
library(stringr)
library(lubridate)
library(ggthemes)
```

```{r echo=FALSE}

x <- read_csv("ps_4_elections-poll-nc09-3.csv",
              col_types = cols(
                .default = col_character(),
                turnout_scale = col_double(),
                turnout_score = col_double(),
                w_LV = col_double(),
                w_RV = col_double(),
                final_weight = col_double(),
                timestamp = col_datetime(format = "")))
```
#Question 1
```{r, echo = FALSE}
d <- x %>% 
  filter(response == "Dem") %>% 
  nrow()
```
There were `r d` respondents who supported the Democratic candidate.
```{r, echo = FALSE}
ru <- x %>% 
  filter(response %in% c("Rep", "Und")) %>%
  group_by(response) %>% 
  count()
```
There were `r ru[1,2] - ru[2,2]` more respondents who favored the Republican candidate than who were Undecided.
```{r, echo = FALSE}
gender <- x %>% 
  select(gender, gender_combined) %>% 
  filter(gender != gender_combined) %>% 
  count()
```
There are two gender variables (gender and gender_combined). There are `r gender[]` individuals for whom these variables have different values.
```{r, echo = FALSE}
wr <- x %>% 
  select(race_eth, file_race_black) %>% 
  filter(race_eth == "White", file_race_black != "White") %>% 
  count()
```
There are `r wr[]` respondents listed as “White” under race_eth who are not listed as “White” under file_race_black.
```{r, echo = FALSE}
time <- x %>% 
  select(response, timestamp) %>%
  filter(response %in% c("Rep", "Dem")) %>% 
  group_by(response) %>% 
  summarize(min = min(timestamp)) %>% 
  spread(response, min) %>% 
  mutate(diff = round(Rep - Dem, digits = 0))
```
The first response of Dem came `r time[1,3]` minutes (rounded to the nearest minute) before the first response of Rep.

#Question 2

```{r, echo = FALSE}
x %>% 
  select(race_eth, response, final_weight) %>% 
  filter(response %in% c("Rep", "Dem", "Und", 3), 
         race_eth != "[DO NOT READ] Don't know/Refused") %>% 
  mutate(race_eth = fct_relevel(race_eth, c("White", "Black", "Hispanic", "Asian", "Other")))  %>%
  group_by(race_eth, response) %>%
  summarize(total = sum(final_weight)) %>% 
  spread(key = response, value = total, fill = 0) %>%
  ungroup() %>%
  mutate(all = Dem + Rep + Und + `3`) %>%
  mutate(Dem = Dem/all) %>% 
  mutate(Rep = Rep/all) %>% 
  mutate(Und = Und/all) %>%
  select(-all, -`3`) %>% 
  na_if(0) %>% 
  gt() %>% 
  cols_label(Dem = "DEM.", Rep = "REP.", Und = "UND.", race_eth = " ") %>% 
  fmt_percent(columns = vars(Dem, Rep, Und), decimals = 0) %>% 
  fmt_missing(columns = 4, rows = 4, missing_text = "-")
  
``` 
  
#Question 3
  
```{r, echo = FALSE}
x %>% 
  filter(educ %in% c("Bachelors' degree", "Grade school", "Graduate or Professional Degree", "High school", "Some college or trade school")) %>% 
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", "Some college or trade school", "Bachelors' degree", "Graduate or Professional Degree"))) %>% 
  group_by(educ) %>% 
  ggplot(aes(x = educ, y = final_weight)) +
  coord_flip() +
  geom_violin() +
  geom_jitter(alpha = .5) +
  theme_gray() +
  labs(title = "More Educated Matter Less in North Carolina 9th", subtitle = "Poll gives more weight to people who are less likely to participate in polls", caption = "New York Times Upshot/Sienna College 2018 live polls") +
  xlab(element_blank()) +
  ylab("Weight Given to Respondent in Calculating Poll Results")
  
```

#Question 4

```{r, echo = FALSE, message=FALSE}
labels <- c(Dem = "Democrats", Rep = "Republicans")
x %>% 
  filter(ager != "[DO NOT READ] Refused", response %in% c("Dem", "Rep")) %>% 
  group_by(response, ager) %>% 
  ggplot(aes(x = ager, fill = response)) +
  geom_bar() +
  facet_wrap(~response, labeller = labeller(response = labels)) +
  theme_gray() +
  scale_fill_manual(breaks = c("Dem", "Rep"), values = c("#008FD5", "#FF2700")) +
  xlab("Age Range of Respondent") +
  ylab("Number of Respondents")
```

#Colleagues
Niel Schrage, Dasha Metropolitansky, 
Study halls with Dillon Smith and Charles Flood
  